<template>
<svg :class="$style.avatar" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1024 1024" enable-background="new 0 0 1024 1024" xml:space="preserve">
<g id="necks">
	<rect id="neck-center" x="473" y="683" fill="#777777" width="78" height="329"/>
	<g id="neck-top">
		<path id="neck-top-color" fill="#bbbbbb" d="M593.331,837.247C591.609,848.111,581.2,857,570.2,857H453.8c-11,0-21.409-8.889-23.131-19.753
			l-17.198-108.493C411.749,717.889,419.34,709,430.34,709h163.32c11,0,18.591,8.889,16.869,19.753L593.331,837.247z"/>
	</g>
	<g id="neck-bottom">
		<path id="neck-bottom-color" fill="#bbbbbb" d="M590,1120c0,11-9,20-20,20H454c-11,0-20-9-20-20V958c0-11,9-20,20-20h116c11,0,20,9,20,20V1120z"/>
	</g>
</g>
<g id="head">
	<g id="antens">
		<g id="anten-right">
			<path fill="#777777" d="M398.304,339.808c1.881,5.168-0.808,10.936-5.977,12.817l-10.384,3.779
				c-5.168,1.881-10.936-0.808-12.817-5.977L262.296,56.915c-1.881-5.168,0.808-10.936,5.977-12.817l10.384-3.779
				c5.168-1.881,10.936,0.808,12.817,5.977L398.304,339.808z"/>
		</g>
		<g id="anten-left">
			<path fill="#777777" d="M625.696,339.808c-1.881,5.168,0.808,10.936,5.977,12.817l10.384,3.779
				c5.168,1.881,10.936-0.808,12.817-5.977l106.83-293.513c1.881-5.168-0.808-10.936-5.977-12.817l-10.384-3.779
				c-5.168-1.881-10.936,0.808-12.817,5.977L625.696,339.808z"/>
		</g>
	</g>
	<g id="face">
		<g id="face-main">
			<g>
				<path id="face-color" fill="#bbbbbb" d="M851,678c0,49.706-40.294,90-90,90H259c-49.706,0-90-40.294-90-90V375c0-49.706,40.294-90,90-90h502
					c49.706,0,90,40.294,90,90V678z"/>
			</g>
		</g>
		<g id="rails">
			<g id="rail-left">
				<g>
					<path id="rail-left-color" fill="#777777" d="M297,635c0,8.284-6.716,15-15,15h-1c-8.284,0-15-6.716-15-15V351c0-8.284,6.716-15,15-15h1
						c8.284,0,15,6.716,15,15V635z"/>
				</g>
			</g>
			<g id="rail-center">
				<g>
					<path id="rail-center-color" fill="#777777" d="M527,686c0,8.284-6.716,15-15,15h-1c-8.284,0-15-6.716-15-15V508c0-8.284,6.716-15,15-15h1
						c8.284,0,15,6.716,15,15V686z"/>
				</g>
			</g>
			<g id="rail-right">
				<g>
					<path id="rail-right-color" fill="#777777" d="M757,635c0,8.284-6.716,15-15,15h-1c-8.284,0-15-6.716-15-15V351c0-8.284,6.716-15,15-15h1
						c8.284,0,15,6.716,15,15V635z"/>
				</g>
			</g>
		</g>
	</g>
	<g id="lip">
		<g>
			<g>
				<path fill="#E9E9E9" d="M567,655c0,11.046-8.954,20-20,20h-70c-11.046,0-20-8.954-20-20v-34c0-11.046,8.954-20,20-20h70
					c11.046,0,20,8.954,20,20V655z"/>
			</g>
		</g>
	</g>
	<g id="eyes">
		<g id="eye-left">
			<g id="eye-left-main">
				<g>
					<path fill="#E9E9E9" d="M421,529c0,16.569-13.431,30-30,30H146c-16.569,0-30-13.431-30-30V418c0-16.569,13.431-30,30-30h245
						c16.569,0,30,13.431,30,30V529z"/>
				</g>
			</g>
			<g id="eye-left-circles">
				<circle id="eye-left-circle" fill="#777777" cx="282" cy="473.212" r="63.25"/>
				<g id="eye-left-circle-middle">
					<g>
						<circle id="eye-left-circle-color" fill="#E5E5E5" cx="282" cy="473.212" r="30.36"/>
					</g>
				</g>
			</g>
		</g>
		<g id="eye-right">
			<g id="eye-right-main">
				<g>
					<path fill="#E9E9E9" d="M908,418c0-16.569-13.431-30-30-30H633c-16.569,0-30,13.431-30,30v111c0,16.569,13.431,30,30,30h245
						c16.569,0,30-13.431,30-30V418z"/>
				</g>
			</g>
			<g id="eye-right-circles">
				<circle id="eye-right-circle" fill="#777777" cx="742" cy="473.212" r="63.25"/>
				<g id="eye-right-circle-middle">
					<g>
						<circle id="eye-right-circle-color" fill="#E5E5E5" cx="742" cy="473.212" r="30.36"/>
					</g>
				</g>
			</g>
		</g>
	</g>
</g>
</svg>

</template>

<script>
import { minifyStr, strToNumber } from '../../utils/handy.js';
export default {
  props: {
    user: {
      type: Object,
    },
    size: {
      type: Number,
      default: 48,
    },
  },
  methods: {
    applyStyle() {
      const svg = this.$el;
      const parts = (() => {
        const ret = {};
        [
          'head',
          // 'face-color',
          'necks',
          // 'neck-top-color',
          // 'neck-bottom-color',
          'lip', 'eye-left',
          'eye-left-circles',
          'eye-left-circle',
          'eye-right',
          'eye-right-circles',
          'eye-right-circle',
          'antens',
          //  'rail-left-color', 'rail-center-color', 'rail-right-color'
        ].forEach((part) => {
          ret[part] = svg.getElementById(part);
          ret[part].style.transformOrigin = 'center';
          ret[part].style.transitionDuration = '0.4s';
          ret[part].style.transitionProperty = 'fill, transform';
          ret[part].style.willChange = 'fill, transform';
        });
        return ret;
      })();
      const unum = (from, to, hash) => strToNumber(minifyStr(this.user.username, 10) + hash, Math.abs(from - to)) - Math.abs(from);
      
      svg.style.width = this.size + 'px';
      svg.style.height = this.size + 'px';

      if (!this.user || !this.user.username) {
        return Object.keys(parts).forEach((part) => {
          parts[part].style.transform = null;
          parts[part].style.fill = null;
        });
      }

      const headTransform = unum(-13, 13, 'F$@^G');
      parts.head.style.transform = `rotate(${headTransform}deg)`;
      parts.necks.style.transform = `rotate(${Math.ceil(headTransform / 3)}deg)`;
      parts.lip.style.transform = `translateY(${unum(-8, 0, 'VS#f')}%)`;
      parts.antens.style.transform = `translateY(${unum(0, 13, ':A$FK')}%)`;
      parts['eye-left'].style.transform = `translateY(${unum(-2, 5, '*&IAX')}%)`;
      parts['eye-right'].style.transform = `translateY(${unum(-2, 5, 'R@$(F')}%)`;
      parts['eye-left-circles'].style.transform = `translateX(${unum(-7, 5, '<IHT')}%)`;
      parts['eye-right-circles'].style.transform = `translateX(${unum(-7, 5, 'ZXDQ')}%)`;
      parts['eye-left-circle'].style.fill = `hsl(${unum(20, 90, '#0F') * 4}, 10%, 50%)`;
      parts['eye-right-circle'].style.fill = parts['eye-left-circle'].style.fill;
      // svg.style.backgroundColor = `hsl(${unum(1, 25, 'VG3Z') * 10}, 70%, 55%)`;
      // parts['rail-left-color'].style.fill = svg.style.backgroundColor;
      // parts['rail-center-color'].style.fill = svg.style.backgroundColor;
      // parts['rail-right-color'].style.fill = svg.style.backgroundColor;

      // parts['face-color'].style.fill = ['#2b2b2b', '#bbbbbb'][unum(0, 1, '#')];
      // // console.log(parts['face-color'].style.fill)
      // parts['neck-top-color'].style.fill = parts['face-color'].style.fill;
      // parts['neck-bottom-color'].style.fill = parts['face-color'].style.fill;
    }
  },
  mounted() {
    this.$nextTick(() => {
      this.applyStyle();
    });
  },
  watch: {
    user() {
      this.applyStyle();
    },
    size() {
      this.applyStyle();
    },
  },
  style({ className, mediaQuery }) {
    return [
      className('avatar', {
        display: 'inline-block',
        position: 'relative',
        // border: 'solid 1px',
        // borderRadius: '50%',
        overflow: 'hidden',
        // backgroundColor: this.$root.theme.primaryColor,
        verticalAlign: 'middle',
        transitionDuration: '0.4s',
        transitionProperty: 'background-color'
      }),
    ];
  }
}
</script>